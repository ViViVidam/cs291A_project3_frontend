(this.webpackJsonpchat_client=this.webpackJsonpchat_client||[]).push([[0],{13:function(e,t,s){},14:function(e,t,s){},15:function(e,t,s){},17:function(e,t,s){"use strict";s.r(t);var a=s(2),n=s.n(a),r=s(7),i=s.n(r),o=(s(13),s(1)),l=s(3),c=s(4),d=s(6),u=s(5),g=(s(14),s(15),s(0)),h=[];function m(e){var t=new Date(1e3*e);return t.toLocaleDateString("en-US")+" "+t.toLocaleTimeString("en-US")}n.a.Component;var j=function(e){Object(d.a)(s,e);var t=Object(u.a)(s);function s(e){var a;Object(l.a)(this,s),(a=t.call(this,e)).messagesEndRef=n.a.createRef(),a.scrollToBottom=function(){a.messagesEndRef.current.scrollIntoView({behavior:"smooth"})};var r=a.props.globalMessage;return a.state={globalMessage:r},a}return Object(c.a)(s,[{key:"setelem",value:function(e){this.setState((function(e){return{globalMessage:this.props.globalMessage}}))}},{key:"cleanup",value:function(){this.setState({globalMessage:[]})}},{key:"componentDidMount",value:function(){this.scrollToBottom()}},{key:"componentDidUpdate",value:function(){this.scrollToBottom()}},{key:"render",value:function(){return this.forums=Object(g.jsxs)("div",{id:"column-middle",children:[this.state.globalMessage.map((function(e){return"message"===e.type?Object(g.jsxs)("div",{className:"messagebox",children:[m(e.time)," ",e.username," ",e.message]}):"server"===e.type?Object(g.jsxs)("div",{className:"messagebox",children:[m(e.time)," ",e.message]}):"part"===e.type?Object(g.jsxs)("div",{className:"messagebox",children:[m(e.time)," ",e.username," has part"]}):"join"===e.type?Object(g.jsxs)("div",{className:"messagebox",children:[m(e.time)," ",e.username," has join"]}):Object(g.jsx)("div",{})})),Object(g.jsx)("div",{ref:this.messagesEndRef})]})}}]),s}(n.a.Component),b=function(e){Object(d.a)(s,e);var t=Object(u.a)(s);function s(e){var a;return Object(l.a)(this,s),(a=t.call(this,e)).state={message:null,disconnect:!1},a.sendingHandler=a.sendingHandler.bind(Object(o.a)(a)),a.swit=a.swit.bind(Object(o.a)(a)),a}return Object(c.a)(s,[{key:"swit",value:function(e){console.log("ppp"),this.setState({disconnect:e}),console.log(this.state.disconnect)}},{key:"sendingHandler",value:function(e){this.setState({message:e.target.value});var t=sessionStorage.getItem("messageToken");if(null!==t&&13===e.nativeEvent.keyCode){if(e.preventDefault(),""!==this.state.message){var s=new FormData;s.append("message",this.state.message);var a=new XMLHttpRequest;a.open("POST",sessionStorage.getItem("url")+"/message"),a.setRequestHeader("Authorization","Bearer "+t),a.onreadystatechange=function(e){4===e.target.readyState&&403!==e.target.status&&null!=t&&(t=e.target.getResponseHeader("token"),sessionStorage.setItem("messageToken",t))},a.send(s),sessionStorage.setItem("messageToken",null),e.target.value="",this.setState({message:e.target.value})}}else console.log("token invalid or keycode")}},{key:"render",value:function(){return Object(g.jsx)("input",{id:"message",onChange:this.sendingHandler,onKeyPress:this.sendingHandler,type:"text",defaultValue:this.state.disconnect?"disconnect":"",disabled:this.state.disconnect})}}]),s}(n.a.Component),v=function(e){Object(d.a)(s,e);var t=Object(u.a)(s);function s(e){var a;return Object(l.a)(this,s),(a=t.call(this,e)).state={timer:new Date},a}return Object(c.a)(s,[{key:"tick",value:function(){this.setState({timer:new Date})}},{key:"componentDidMount",value:function(){var e=this;this.timerID=setInterval((function(){return e.tick()}),1e3)}},{key:"render",value:function(){return Object(g.jsxs)("div",{id:"time",children:[this.state.timer.toLocaleTimeString(),"  online users"]})}}]),s}(n.a.Component),p=(n.a.Component,function(e){Object(d.a)(s,e);var t=Object(u.a)(s);function s(e){var a;return Object(l.a)(this,s),(a=t.call(this,e)).messageBarEle=n.a.createRef(),a.cleaner=n.a.createRef(),a.state={globalMessage:[],usersList:[],message:"",disconnect:!0},a.joinHandler=a.joinHandler.bind(Object(o.a)(a)),a.messageHandler=a.messageHandler.bind(Object(o.a)(a)),a.partHandler=a.partHandler.bind(Object(o.a)(a)),a.usersHandler=a.usersHandler.bind(Object(o.a)(a)),a.disconnectHandler=a.disconnectHandler.bind(Object(o.a)(a)),a.serverStatusHandler=a.serverStatusHandler.bind(Object(o.a)(a)),a.errorHandler=a.errorHandler.bind(Object(o.a)(a)),a.openHandler=a.openHandler.bind(Object(o.a)(a)),a.lastHandler=a.lastHandler.bind(Object(o.a)(a)),a}return Object(c.a)(s,[{key:"errorHandler",value:function(e){console.log("error"),this.messageBarEle.current.swit(!0),this.setState({usersList:[],disconnect:!0}),console.log("Disconnected, retrying")}},{key:"messageHandler",value:function(e){var t=JSON.parse(e.data),s={time:t.created,username:t.user,message:t.message,type:"message"},a=this.state.globalMessage;a.push(s),this.setState({globalMessage:a}),this.cleaner.current.setelem(s)}},{key:"disconnectHandler",value:function(e){this.stream.close(),this.setState({disconnect:!0}),sessionStorage.setItem("messageToken",null),sessionStorage.setItem("streamToken",null),Object(r.render)(Object(g.jsx)(O,{}),document.getElementById("root")),console.log("disconnect")}},{key:"partHandler",value:function(e){var t=JSON.parse(e.data),s={time:t.created,username:t.user,message:null,type:"part"},a=this.state.globalMessage;a.push(s),this.setState({globalMessage:a}),console.log(this.state.globalMessage);var n=function(e,t){var s=e.indexOf(t);return s>-1&&e.splice(s,1),e}(this.state.usersList,t.user);this.setState({usersList:n}),console.log(this.state.usersList),console.log("part")}},{key:"openHandler",value:function(e){this.setState({disconnect:!1}),this.messageBarEle.current.swit(!1),console.log("open")}},{key:"usersHandler",value:function(e){console.log("users");var t=JSON.parse(e.data).users;this.setState({usersList:t}),h=t,console.log(this.state.usersList)}},{key:"serverStatusHandler",value:function(e){var t=JSON.parse(e.data),s={time:t.created,username:null,message:t.status,type:"server"},a=this.state.globalMessage;a.push(s),this.setState({globalMessage:a}),console.log("server")}},{key:"lastHandler",value:function(e){console.log("Received a message event: ["+e.lastEventId+"]",e.data)}},{key:"joinHandler",value:function(e){var t=JSON.parse(e.data),s={time:t.created,username:t.user,message:null,type:"join"},a=this.state.globalMessage;a.push(s),this.setState({globalMessage:a}),console.log(t.user),this.state.usersList.includes(t.user)||(this.state.usersList.push(t.user),this.setState((function(e){return{usersList:e.usersList}}))),console.log(this.state.usersList),console.log("join")}},{key:"componentDidMount",value:function(){this.stream=new EventSource(sessionStorage.getItem("url")+"/stream/"+sessionStorage.getItem("streamToken")),this.stream.addEventListener("error",this.errorHandler,!1),this.stream.addEventListener("Disconnect",this.disconnectHandler,!1),this.stream.addEventListener("Message",this.messageHandler,!1),this.stream.addEventListener("Part",this.partHandler,!1),this.stream.addEventListener("ServerStatus",this.serverStatusHandler,!1),this.stream.addEventListener("Message",this.lastHandler,!1),this.stream.addEventListener("open",this.openHandler),this.stream.addEventListener("Users",this.usersHandler,!1),this.stream.addEventListener("Join",this.joinHandler,!1);var e=document.getElementById("column-middle");e.scrollTop=e.scrollHeight}},{key:"render",value:function(){return Object(g.jsxs)("div",{className:"App",children:[Object(g.jsx)("header",{className:"App-header",children:Object(g.jsxs)("div",{id:"welcome-notice",children:["welcome ",this.state.disconnect?"reconnecting":sessionStorage.getItem("username")]})}),Object(g.jsx)("div",{className:"App-body",children:Object(g.jsxs)("div",{className:"sub-title",children:[Object(g.jsx)("div",{id:"webpage-name",children:" suebchat "}),Object(g.jsx)("div",{id:"subtitle-main",children:"Forums "}),Object(g.jsx)(v,{})]})}),Object(g.jsxs)("div",{className:"App-main",children:[Object(g.jsx)("div",{id:"column-left",children:Object(g.jsx)("li",{id:"stream",children:"streams"})}),Object(g.jsx)(j,{globalMessage:this.state.globalMessage,ref:this.cleaner}),Object(g.jsx)("div",{id:"column-right",children:Object(g.jsx)("ul",{id:"user_list",children:this.state.usersList.map((function(e){return Object(g.jsxs)("li",{children:[" ",e," "]})}))})})]}),Object(g.jsx)("footer",{children:Object(g.jsx)(b,{disconnect:this.state.disconnect,ref:this.messageBarEle})})]})}}]),s}(n.a.Component)),O=function(e){Object(d.a)(s,e);var t=Object(u.a)(s);function s(e){var a;return Object(l.a)(this,s),(a=t.call(this,e)).state={userVal:"",urlVal:"http://localhost:3001",passVal:""},a.urlHandler=a.urlHandler.bind(Object(o.a)(a)),a.userHandler=a.userHandler.bind(Object(o.a)(a)),a.passwordHandler=a.passwordHandler.bind(Object(o.a)(a)),a.handleEnter=a.handleEnter.bind(Object(o.a)(a)),a.username=Object(g.jsx)("input",{id:"username",onChange:a.userHandler,type:"text"}),a.url=Object(g.jsx)("input",{id:"url",defaultValue:"http://localhost:3001",onChange:a.urlHandler,type:"text"}),a.password=Object(g.jsx)("input",{id:"password",onChange:a.passwordHandler,type:"password"}),a}return Object(c.a)(s,[{key:"userHandler",value:function(e){this.setState({userVal:e.target.value})}},{key:"urlHandler",value:function(e){this.setState({urlVal:e.target.value})}},{key:"passwordHandler",value:function(e){this.setState({passVal:e.target.value})}},{key:"handleEnter",value:function(e){if(13===e.nativeEvent.keyCode){if(console.log("running"),!(this.state.passVal&&this.state.userVal&&this.state.urlVal))return alert("empty fields!"),console.log(this.state.passVal),console.log(this.state.userVal),void console.log(this.state.urlVal);var t=new FormData;t.append("password",this.state.passVal),t.append("username",this.state.userVal),sessionStorage.setItem("url",this.state.urlVal);var s=new XMLHttpRequest,a=sessionStorage.getItem("url");s.open("POST",a+"/login",!0),s.onreadystatechange=function(){if(4===s.readyState){if(201===s.status){var e=JSON.parse(this.responseText);return sessionStorage.setItem("messageToken",e.message_token),sessionStorage.setItem("streamToken",e.stream_token),void Object(r.render)(Object(g.jsx)(p,{}),document.getElementById("root"))}return 403===s.status?void alert("Invalid username or password"):200===s.status?void 0:void alert(s.status+" failure to /login")}},sessionStorage.setItem("username",this.state.userVal),s.send(t)}}},{key:"render",value:function(){return Object(g.jsx)("div",{id:"login-modal",children:Object(g.jsxs)("div",{className:"content",onKeyPress:this.handleEnter,children:[Object(g.jsx)("h2",{children:"Login"}),Object(g.jsx)("div",{children:Object(g.jsxs)("label",{children:["Chat URL ",Object(g.jsx)("br",{}),this.url]})}),Object(g.jsx)("div",{children:Object(g.jsxs)("label",{children:["Username ",Object(g.jsx)("br",{}),this.username]})}),Object(g.jsx)("div",{children:Object(g.jsxs)("label",{children:["Password ",Object(g.jsx)("br",{}),this.password]})})]})})}}]),s}(n.a.Component);function f(){return null===sessionStorage.getItem("messageToken")?Object(g.jsx)(O,{}):Object(g.jsx)(p,{})}window.onunload=function(){sessionStorage.removeItem("messageToken"),sessionStorage.removeItem("streamToken")};var S=function(e){e&&e instanceof Function&&s.e(3).then(s.bind(null,18)).then((function(t){var s=t.getCLS,a=t.getFID,n=t.getFCP,r=t.getLCP,i=t.getTTFB;s(e),a(e),n(e),r(e),i(e)}))};var H=document.getElementById("root");i.a.render(Object(g.jsx)(f,{}),H),S()}},[[17,1,2]]]);
//# sourceMappingURL=main.5481fcb9.chunk.js.map
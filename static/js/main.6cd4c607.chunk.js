(this.webpackJsonpchat_client=this.webpackJsonpchat_client||[]).push([[0],{13:function(e,t,s){},14:function(e,t,s){},15:function(e,t,s){},17:function(e,t,s){"use strict";s.r(t);var n=s(2),a=s.n(n),r=s(7),i=s.n(r),o=(s(13),s(1)),l=s(3),c=s(4),d=s(6),u=s(5),h=(s(14),s(15),s(0)),g=[];function m(e){var t=new Date(1e3*e);return t.toLocaleDateString("en-US")+" "+t.toLocaleTimeString("en-US")}a.a.Component;var j=function(e){Object(d.a)(s,e);var t=Object(u.a)(s);function s(e){var n;Object(l.a)(this,s),(n=t.call(this,e)).messagesEndRef=a.a.createRef(),n.scrollToBottom=function(){n.messagesEndRef.current.scrollIntoView({behavior:"smooth"})};var r=n.props.globalMessage;return n.state={globalMessage:r},n}return Object(c.a)(s,[{key:"componentDidMount",value:function(){this.scrollToBottom()}},{key:"componentDidUpdate",value:function(){this.scrollToBottom()}},{key:"render",value:function(){return this.forums=Object(h.jsxs)("div",{id:"column-middle",children:[this.state.globalMessage.map((function(e){return"message"===e.type?Object(h.jsxs)("div",{children:[m(e.time)," ",e.username," ",e.message]}):"server"===e.type?Object(h.jsxs)("div",{children:[m(e.time)," ",e.message]}):"part"===e.type?Object(h.jsxs)("div",{children:[m(e.time)," ",e.username," has part"]}):"join"===e.type?Object(h.jsxs)("div",{children:[m(e.time)," ",e.username," has join"]}):Object(h.jsx)("div",{})})),Object(h.jsx)("div",{ref:this.messagesEndRef})]})}}]),s}(a.a.Component),b=function(e){Object(d.a)(s,e);var t=Object(u.a)(s);function s(e){var n;return Object(l.a)(this,s),(n=t.call(this,e)).state={message:null,disconnect:!1},n.sendingHandler=n.sendingHandler.bind(Object(o.a)(n)),n.swit=n.swit.bind(Object(o.a)(n)),n}return Object(c.a)(s,[{key:"swit",value:function(e){console.log("ppp"),this.setState({disconnect:e}),console.log(this.state.disconnect)}},{key:"sendingHandler",value:function(e){this.setState({message:e.target.value});var t=sessionStorage.getItem("messageToken");if(null!==t&&13===e.nativeEvent.keyCode){if(e.preventDefault(),""!==this.state.message){var s=new FormData;s.append("message",this.state.message);var n=new XMLHttpRequest;n.open("POST",sessionStorage.getItem("url")+"/message"),n.setRequestHeader("Authorization","Bearer "+t),n.onreadystatechange=function(e){4===e.target.readyState&&403!==e.target.status&&null!=t&&(t=e.target.getResponseHeader("token"),sessionStorage.setItem("messageToken",t))},n.send(s),sessionStorage.setItem("messageToken",null),e.target.value="",this.setState({message:e.target.value})}}else console.log("token invalid or keycode")}},{key:"render",value:function(){return Object(h.jsx)("input",{id:"message",onChange:this.sendingHandler,onKeyPress:this.sendingHandler,type:"text",defaultValue:this.state.disconnect?"disconnect":"",disabled:this.state.disconnect})}}]),s}(a.a.Component),v=function(e){Object(d.a)(s,e);var t=Object(u.a)(s);function s(e){var n;return Object(l.a)(this,s),(n=t.call(this,e)).state={timer:new Date},n}return Object(c.a)(s,[{key:"tick",value:function(){this.setState({timer:new Date})}},{key:"componentDidMount",value:function(){var e=this;this.timerID=setInterval((function(){return e.tick()}),1e3)}},{key:"render",value:function(){return Object(h.jsxs)("div",{id:"time",children:[this.state.timer.toLocaleTimeString(),"  online users"]})}}]),s}(a.a.Component),p=(a.a.Component,function(e){Object(d.a)(s,e);var t=Object(u.a)(s);function s(e){var n;return Object(l.a)(this,s),(n=t.call(this,e)).messageBarEle=a.a.createRef(),n.state={globalMessage:[],usersList:[],message:"",disconnect:!0},n.joinHandler=n.joinHandler.bind(Object(o.a)(n)),n.messageHandler=n.messageHandler.bind(Object(o.a)(n)),n.partHandler=n.partHandler.bind(Object(o.a)(n)),n.usersHandler=n.usersHandler.bind(Object(o.a)(n)),n.disconnectHandler=n.disconnectHandler.bind(Object(o.a)(n)),n.serverStatusHandler=n.serverStatusHandler.bind(Object(o.a)(n)),n.errorHandler=n.errorHandler.bind(Object(o.a)(n)),n.openHandler=n.openHandler.bind(Object(o.a)(n)),n.lastHandler=n.lastHandler.bind(Object(o.a)(n)),n}return Object(c.a)(s,[{key:"errorHandler",value:function(e){console.log("error"),this.messageBarEle.current.swit(!0),this.setState({usersList:[],disconnect:!0}),console.log("Disconnected, retrying")}},{key:"messageHandler",value:function(e){var t=JSON.parse(e.data),s={time:t.created,username:t.user,message:t.message,type:"message"},n=this.state.globalMessage;n.push(s),this.setState({globalMessage:n}),console.log("message")}},{key:"disconnectHandler",value:function(e){this.stream.close(),this.setState({usersList:[],disconnect:!0}),sessionStorage.setItem("messageToken",null),sessionStorage.setItem("streamToken",null),Object(r.render)(Object(h.jsx)(O,{}),document.getElementById("root")),console.log("disconnect")}},{key:"partHandler",value:function(e){var t=JSON.parse(e.data),s={time:t.created,username:t.user,message:null,type:"part"},n=this.state.globalMessage;n.push(s),this.setState({globalMessage:n}),console.log(this.state.globalMessage);var a=function(e,t){var s=e.indexOf(t);return s>-1&&e.splice(s,1),e}(this.state.usersList,t.user);this.setState({usersList:a}),console.log("part")}},{key:"openHandler",value:function(e){this.setState({disconnect:!1}),this.messageBarEle.current.swit(!1),console.log("open")}},{key:"usersHandler",value:function(e){console.log("users");var t=JSON.parse(e.data).users;this.setState({usersList:t}),g=t}},{key:"serverStatusHandler",value:function(e){var t=JSON.parse(e.data),s={time:t.created,username:null,message:t.status,type:"server"},n=this.state.globalMessage;n.push(s),this.setState({globalMessage:n}),console.log("server")}},{key:"lastHandler",value:function(e){console.log("Received a message event: ["+e.lastEventId+"]",e.data)}},{key:"joinHandler",value:function(e){var t=JSON.parse(e.data),s={time:t.created,username:t.user,message:null,type:"join"},n=this.state.globalMessage;n.push(s),this.setState({globalMessage:n}),console.log(t.user),this.state.usersList.includes(t.user)||(this.state.usersList.push(t.user),this.setState((function(e){return{usersList:e.usersList}}))),console.log("join")}},{key:"componentDidMount",value:function(){this.stream=new EventSource(sessionStorage.getItem("url")+"/stream/"+sessionStorage.getItem("streamToken")),this.stream.addEventListener("error",this.errorHandler,!1),this.stream.addEventListener("Disconnect",this.disconnectHandler,!1),this.stream.addEventListener("Message",this.messageHandler,!1),this.stream.addEventListener("Part",this.partHandler,!1),this.stream.addEventListener("ServerStatus",this.serverStatusHandler,!1),this.stream.addEventListener("Message",this.lastHandler,!1),this.stream.addEventListener("open",this.openHandler),this.stream.addEventListener("Users",this.usersHandler,!1),this.stream.addEventListener("Join",this.joinHandler,!1);var e=document.getElementById("column-middle");e.scrollTop=e.scrollHeight}},{key:"render",value:function(){return Object(h.jsxs)("div",{className:"App",children:[Object(h.jsx)("header",{className:"App-header",children:Object(h.jsxs)("div",{id:"welcome-notice",children:["welcome ",this.state.disconnect?"reconnecting":sessionStorage.getItem("username")]})}),Object(h.jsx)("div",{className:"App-body",children:Object(h.jsxs)("div",{className:"sub-title",children:[Object(h.jsx)("div",{id:"webpage-name",children:" suebchat "}),Object(h.jsx)("div",{id:"subtitle-main",children:"Forums "}),Object(h.jsx)(v,{})]})}),Object(h.jsxs)("div",{className:"App-main",children:[Object(h.jsx)("div",{id:"column-left",children:Object(h.jsx)("li",{id:"stream",children:"streams"})}),Object(h.jsx)(j,{globalMessage:this.state.globalMessage}),Object(h.jsx)("div",{id:"column-right",children:Object(h.jsx)("ul",{id:"user_list",children:this.state.usersList.map((function(e){return Object(h.jsxs)("li",{children:[" ",e," "]})}))})})]}),Object(h.jsx)("footer",{children:Object(h.jsx)(b,{disconnect:this.state.disconnect,ref:this.messageBarEle})})]})}}]),s}(a.a.Component)),O=function(e){Object(d.a)(s,e);var t=Object(u.a)(s);function s(e){var n;return Object(l.a)(this,s),(n=t.call(this,e)).state={userVal:"",urlVal:"http://localhost:3001",passVal:""},n.urlHandler=n.urlHandler.bind(Object(o.a)(n)),n.userHandler=n.userHandler.bind(Object(o.a)(n)),n.passwordHandler=n.passwordHandler.bind(Object(o.a)(n)),n.handleEnter=n.handleEnter.bind(Object(o.a)(n)),n.username=Object(h.jsx)("input",{id:"username",onChange:n.userHandler,type:"text"}),n.url=Object(h.jsx)("input",{id:"url",defaultValue:"http://localhost:3001",onChange:n.urlHandler,type:"text"}),n.password=Object(h.jsx)("input",{id:"password",onChange:n.passwordHandler,type:"password"}),n}return Object(c.a)(s,[{key:"userHandler",value:function(e){this.setState({userVal:e.target.value})}},{key:"urlHandler",value:function(e){this.setState({urlVal:e.target.value})}},{key:"passwordHandler",value:function(e){this.setState({passVal:e.target.value})}},{key:"handleEnter",value:function(e){if(13===e.nativeEvent.keyCode){if(console.log("running"),!(this.state.passVal&&this.state.userVal&&this.state.urlVal))return alert("empty fields!"),console.log(this.state.passVal),console.log(this.state.userVal),void console.log(this.state.urlVal);var t=new FormData;t.append("password",this.state.passVal),t.append("username",this.state.userVal),sessionStorage.setItem("url",this.state.urlVal);var s=new XMLHttpRequest,n=sessionStorage.getItem("url");s.open("POST",n+"/login",!0),s.onreadystatechange=function(){if(4===s.readyState){if(201===s.status){var e=JSON.parse(this.responseText);return sessionStorage.setItem("messageToken",e.message_token),sessionStorage.setItem("streamToken",e.stream_token),void Object(r.render)(Object(h.jsx)(p,{}),document.getElementById("root"))}return 403===s.status?void alert("Invalid username or password"):200===s.status?void 0:void alert(s.status+" failure to /login")}},sessionStorage.setItem("username",this.state.userVal),s.send(t)}}},{key:"render",value:function(){return Object(h.jsx)("div",{id:"login-modal",children:Object(h.jsxs)("div",{className:"content",onKeyPress:this.handleEnter,children:[Object(h.jsx)("h2",{children:"Login"}),Object(h.jsx)("div",{children:Object(h.jsxs)("label",{children:["Chat URL ",Object(h.jsx)("br",{}),this.url]})}),Object(h.jsx)("div",{children:Object(h.jsxs)("label",{children:["Username ",Object(h.jsx)("br",{}),this.username]})}),Object(h.jsx)("div",{children:Object(h.jsxs)("label",{children:["Password ",Object(h.jsx)("br",{}),this.password]})})]})})}}]),s}(a.a.Component);function f(){return null===sessionStorage.getItem("messageToken")?Object(h.jsx)(O,{}):Object(h.jsx)(p,{})}window.onunload=function(){sessionStorage.removeItem("messageToken"),sessionStorage.removeItem("streamToken")};var H=function(e){e&&e instanceof Function&&s.e(3).then(s.bind(null,18)).then((function(t){var s=t.getCLS,n=t.getFID,a=t.getFCP,r=t.getLCP,i=t.getTTFB;s(e),n(e),a(e),r(e),i(e)}))};var S=document.getElementById("root");i.a.render(Object(h.jsx)(f,{}),S),H()}},[[17,1,2]]]);
//# sourceMappingURL=main.6cd4c607.chunk.js.map